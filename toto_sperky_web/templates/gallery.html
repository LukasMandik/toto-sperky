{% extends 'base.html' %}
{% load static %}
{% block title %}Galllery{% endblock %}

{% block content %}

<div class="gallery_content_page">
    <div class="categories">
        <ul class="categories-list">
            <div class="categories_item">
                <li {% if not selected_category %} class="selected"{% endif %}><a class="category-link" href="/gallery">Všetko</a></li>
            </div>
            {% for category in categories %}
            <div class="categories_item">
                <li {% if category.name == selected_category %} class="selected"{% endif %}><a  class="category-link" href="/gallery?category={{ category.name }}">{{ category.name }}</a>
                    <img src="{{ category.image.url }}" alt="{{ category.name }}" class="gallery-image"  data-slug="{{ product.slug }}">
                </li>
            </div>
            {% endfor %}
        </ul>
    </div>
    {% include "partials/product_list.html" %}
            <!-- <div id="modal" class="modal">
                <div class="modal-content">
                    <span class="close-button">&times;</span>

                    <div class="modal-body">
            
                        <h3 class="modal-name"></h3>
                        <img src="" class="modal-img" alt="">
                        <p class="modal-description"></p>
                        
                    </div>
        
                    <span class="previous-button"><i class='bx bx-chevron-left' ></i></span> 
                    <span class="next-button"><i class='bx bx-chevron-right' ></i></span> 
          

                </div>
            </div> -->
        

            <!-- <div id="modal" class="modal">
                <span class="close-button">&times;</span>
                <span class="previous-button"><i class='bx bx-chevron-left' ></i></span> 
                <span class="next-button"><i class='bx bx-chevron-right' ></i></span> 
                <div class="modal-content">
     
                </div>
                <div class="modal-body">
        
                </div>
              
            </div> -->
            
        {% if not products %}
        <p>No products found.</p>
        {% endif %}

    </div>

</div>
 



<script>
function initializeGSAPAnimations() {
    gsap.utils.toArray('.container').forEach((elem) => {
        let lines = elem.querySelectorAll('.container .box');

        lines.forEach((line) => {
            let timeline = gsap.timeline({
                ease: "elastic",
                scrollTrigger: {
                    trigger: line,
                    start: "top 630svh",
                    end: "bottom 600svh",
                    scrub: false,
                    // markers: true,
                    toggleActions: "restart none none reverse",
                },
            });

            timeline.from(line, { opacity: 0, y: 20 });
        });
    });

    gsap.registerPlugin(ScrollTrigger);
  
  gsap.utils.toArray('.line_center_short').forEach((elem) => {
    let line = elem.querySelector('.line');
    let lineLength = line.getTotalLength();

    // Nastavte strokeDasharray a počiatočný offset
    line.style.strokeDasharray = lineLength;
    line.style.strokeDashoffset = lineLength; // Začne od stredu

    // Vytvorte časovú os pre animáciu
    let Timeline = gsap.timeline({
      scrollTrigger: {
        trigger: elem,
        easy:"linear",
        start: "top 500svh",
        end: "bottom 300svh",
        scrub: true,
        // markers: true,
        // toggleActions: "restart none none reverse",  
      }
    });

    // Animačný efekt, ktorý zobrazí čiaru od stredu po oba konce
    Timeline
      .to(line, { strokeDashoffset: 0 }) // Záporná hodnota pre animáciu oboma smermi
  });

}

document.addEventListener('DOMContentLoaded', function () {
    initializeGSAPAnimations(); // Spustí animácie GSAP

    document.querySelectorAll('.category-link').forEach(link => {
        link.addEventListener('click', function (e) {
            e.preventDefault();  // Zabránite úplnému obnoveniu stránky
            var url = this.getAttribute('href');  // Získa cieľový odkaz

            // AJAX na načítanie produktov
            fetch(url, { method: 'GET' })
                .then(response => response.text())  // Získa HTML
                .then(html => {
                    var newContent = $(html).find('.gallery_container').html();  // Získa partial
                    $('.gallery_container').html(newContent);  // Aktualizuje zoznam produktov
                    
                    // Odstráni starý "selected" a pridá nový
                    document.querySelectorAll('.category-link').forEach(l => {
                        l.parentElement.classList.remove('selected');  // Odstráni "selected"
                    });

                    this.parentElement.classList.add('selected');  // Pridá "selected" na vybranú kategóriu

                    // Znovu inicializuje GSAP animácie
                    initializeGSAPAnimations();  // Spustí animácie GSAP po obnovení obsahu
                })
                .catch(error => console.error('Chyba pri načítaní produktov:', error));
        });
    });
});
</script>




<!-- <script>
  document.addEventListener('DOMContentLoaded', function () {
    const modal = document.getElementById('modal');
    const modalContent = document.querySelector('.modal-content');
    const closeButton = document.querySelector('.close-button');
    const modalImg = document.querySelector('.modal-img');
    const modalName = document.querySelector('.modal-name');
    const modalDescription = document.querySelector('.modal-description');
    const galleryImages = document.querySelectorAll('.container .box img');
    const nextButton = document.querySelector('.next-button');
    const previousButton = document.querySelector('.previous-button');
    
    let currentIndex = -1;
    let originalUrl = window.location.pathname; // Uloží pôvodnú URL pre prípadné vrátenie

    const fetchProductData = (slug) => {
        return fetch(`/product/${slug}/data/`)
            .then(response => response.json())
            .catch(error => console.error('Error fetching product data:', error));
    };

    const showProductInModal = (index, updateHistory = true) => {
        if (index >= 0 && index < galleryImages.length) {
            const slug = galleryImages[index].getAttribute('data-slug');
            fetchProductData(slug)
                .then(data => {
                    modalImg.src = data.image_url;
                    modalName.innerText = data.name;
                    modalDescription.innerText = data.description;
                    
                    document.body.style.overflow = 'hidden'; // Zastaví posúvanie
                    modal.style.display = 'flex'; // Zobrazí modal
                    currentIndex = index; // Nastaví aktuálny index
                    
                    if (updateHistory) {
                        history.pushState({ product: slug }, '', `/product/${slug}/`); // Aktualizuje URL
                    }
                });
        }
    };

    galleryImages.forEach((img, index) => {
        img.addEventListener('click', function () {
            showProductInModal(index);
        });
    });

    // Pridanie podpory pre tlačidlo "Späť"
    window.addEventListener('popstate', function (e) {
        const state = e.state;

        if (state && state.product) { // Ak je produkt v histórii
            const productIndex = Array.from(galleryImages).findIndex(img => img.getAttribute('data-slug') === state.product);

            if (productIndex >= 0) {
                showProductInModal(productIndex, false); // Obnoví modál bez aktualizácie histórie
            }
        } else { 
            // Ak nie je stav s produktom, zatvára modal
            modal.style.display = 'none';
            document.body.style.overflow = 'auto'; // Obnoví posúvanie
        }
    });

    closeButton.addEventListener('click', function () {
        modal.style.display = 'none'; // Zavrie modal
        document.body.style.overflow = 'auto'; // Obnoví posúvanie
        
        // Návrat na pôvodnú URL
        if (window.location.pathname !== originalUrl) {
            history.pushState(null, '', originalUrl); // Vráti na pôvodnú URL
        }
    });

    // Posun na ďalší produkt
    nextButton.addEventListener('click', function () {
        if (currentIndex + 1 < galleryImages.length) {
            showProductInModal(currentIndex + 1);
        }
    });

    // Posun na predchádzajúci produkt
    previousButton.addEventListener('click', function () {
        if (currentIndex - 1 >= 0) {
            showProductInModal(currentIndex - 1);
        }
    });

    modal.addEventListener('click', function (e) {
        if (e.target === modal) {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto'; // Obnoví posúvanie
            
            // Návrat na pôvodnú URL
            if (window.location.pathname !== originalUrl) {
                history.pushState(null, '', originalUrl); // Vráti na pôvodnú URL
            }
        }
    });
});
    </script> -->
    


<!-- <script>
    document.addEventListener('DOMContentLoaded', function () {
    const modal = document.getElementById('modal');
    const modalContent = document.querySelector('.modal-content');
    const galleryImages = document.querySelectorAll('.container .box img');

    galleryImages.forEach(img => {
        img.addEventListener('click', function () {
            const slug = this.getAttribute('data-slug'); // predpokladáme, že máte slug ako atribút
            fetch(`/product/${slug}/`) // použite slug na získanie detailov produktu
            .then(response => response.text())
            .then(html => {
                modalContent.innerHTML = html; // Naplnenie modálu obsahom
                modal.style.display = 'flex'; // Zobrazenie modálu
            })
            .catch(error => console.error('Error fetching product details:', error));
        });
    });

    const closeButton = document.querySelector('.close-button');
    closeButton.addEventListener('click', function () {
        modal.style.display = 'none'; // Skrytie modálu
    });

    modal.addEventListener('click', function (e) {
        if (e.target === modal) {
            modal.style.display = 'none'; // Skrytie modálu pri kliknutí mimo jeho obsahu
        }
    });
});

</script> -->


<!-- <script>
    document.addEventListener('DOMContentLoaded', function () {
    const modal = document.getElementById('modal');
    const modalContent = document.querySelector('.modal-content');
    const closeButton = document.querySelector('.close-button');
    const galleryImages = document.querySelectorAll('.container .box img');
    
    let currentIndex = -1;

    const showProductInModal = (index) => {
        if (index >= 0 && index < galleryImages.length) {
            const slug = galleryImages[index].getAttribute('slug'); // Získa slug produktu
            const productUrl = `/product/${slug}/`; // URL z slugu

            fetch(productUrl) // Načítanie detailov produktu
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Request failed with status ${response.status}`);
                    }
                    return response.text();
                })
                .then(html => {
                    modalContent.innerHTML = html; // Zobrazí obsah modálu
                    document.body.style.overflow = 'hidden'; // Zastavte posúvanie
                    modal.style.display = 'flex'; // Zobrazí modal
                    currentIndex = index; // Nastaví aktuálny index
                })
                .catch(error => console.error('Error fetching product details:', error));
        }
    };

    galleryImages.forEach((img, index) => {
        img.addEventListener('click', function (event) {
            event.preventDefault(); // Zabraňuje otvoreniu novej stránky
            showProductInModal(index);
        });
    });

    const nextButton = document.querySelector('.next-button');
    const previousButton = document.querySelector('.previous-button');

    nextButton.addEventListener('click', function () {
        showProductInModal(currentIndex + 1); // Posun na ďalší obrázok
    });

    previousButton.addEventListener('click', function () {
        showProductInModal(currentIndex - 1); // Posun na predchádzajúci obrázok
    });

    closeButton.addEventListener('click', function () {
        modal.style.display = 'none'; // Skrytie modálu
        document.body.style.overflow = 'auto'; // Obnovte posúvanie
    });

    modal.addEventListener('click', function (e) {
        if (e.target === modal) {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto'; // Obnovte posúvanie
        }
    });
});
</script> -->
{% endblock %}