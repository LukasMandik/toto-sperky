{% extends 'base.html' %}
{% load static %}
{% block title %}Galllery{% endblock %}

{% block content %}

<div class="gallery_content_page">
    <div class="categories">
        <!-- <h3 class="">Kategorie</h3> -->
        <ul class="categories-list">
            <div class="categories_item">
                <li {% if not selected_category %} class="selected"{% endif %}><a class="category-link" href="/gallery">Všetko</a></li>
            </div>
            {% for category in categories %}
            <div class="categories_item">
                <li {% if category.name == selected_category %} class="selected"{% endif %}><a  class="category-link" href="/gallery?category={{ category.name }}">{{ category.name }}</a>
                    {% if category.image %}
                        <img src="{{ category.image.url }}" alt="{{ category.name }}" class="gallery-image"  data-slug="{{ product.slug }}">
                    {% endif %}
                </li>
            </div>
            {% endfor %}
        </ul>
    </div>
    {% include "partials/product_list.html" %}
    
        {% if not products %}
        <p>No products found.</p>
        {% endif %}

    </div>

</div>
 




<script>
function initializeGSAPAnimations() {
    gsap.utils.toArray('.container').forEach((elem) => {
        let lines = elem.querySelectorAll('.container .box');

        lines.forEach((line) => {
            let timeline = gsap.timeline({
                ease: "elastic",
                scrollTrigger: {
                    trigger: line,
                    start: "top 630svh",
                    end: "bottom 600svh",
                    scrub: false,
                    // markers: true,
                    toggleActions: "restart none none reverse",
                },
            });

            timeline.from(line, { opacity: 0, y: 20 });
        });
    });

    gsap.registerPlugin(ScrollTrigger);
  
  gsap.utils.toArray('.line_center_short').forEach((elem) => {
    let line = elem.querySelector('.line');
    let lineLength = line.getTotalLength();

    // Nastavte strokeDasharray a počiatočný offset
    line.style.strokeDasharray = lineLength;
    line.style.strokeDashoffset = lineLength; // Začne od stredu

    // Vytvorte časovú os pre animáciu
    let Timeline = gsap.timeline({
      scrollTrigger: {
        trigger: elem,
        easy:"linear",
        start: "top 500svh",
        end: "bottom 300svh",
        scrub: true,
        // markers: true,
        // toggleActions: "restart none none reverse",  
      }
    });

    // Animačný efekt, ktorý zobrazí čiaru od stredu po oba konce
    Timeline
      .to(line, { strokeDashoffset: 0 }) // Záporná hodnota pre animáciu oboma smermi
  });

}

document.addEventListener('DOMContentLoaded', function () {
    initializeGSAPAnimations(); // Spustí animácie GSAP

    document.querySelectorAll('.category-link').forEach(link => {
        link.addEventListener('click', function (e) {
            e.preventDefault();  // Zabránite úplnému obnoveniu stránky
            var url = this.getAttribute('href');  // Získa cieľový odkaz

            // AJAX na načítanie produktov
            fetch(url, { method: 'GET' })
                .then(response => response.text())  // Získa HTML
                .then(html => {
                    var newContent = $(html).find('.gallery_container').html();  // Získa partial
                    $('.gallery_container').html(newContent);  // Aktualizuje zoznam produktov
                    
                    // Odstráni starý "selected" a pridá nový
                    document.querySelectorAll('.category-link').forEach(l => {
                        l.parentElement.classList.remove('selected');  // Odstráni "selected"
                    });

                    this.parentElement.classList.add('selected');  // Pridá "selected" na vybranú kategóriu

                    // Znovu inicializuje GSAP animácie
                    initializeGSAPAnimations();  // Spustí animácie GSAP po obnovení obsahu
                })
                .catch(error => console.error('Chyba pri načítaní produktov:', error));
        });
    });
});
</script>





{% endblock %}